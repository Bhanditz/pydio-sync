<!DOCTYPE html>
<html lang="en" >
    <head>
        <title>PydioSync</title> <!-- Application title -->

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />

        <link rel="stylesheet" href="assets/angular-material.min.css"/>
        <link rel="stylesheet" href="assets/md/material-icons.css"/>
        <link rel="stylesheet" href="assets/Roboto/roboto.css"/>
        <!-- <link rel="stylesheet" href="assets/app.css"/> -->
        <link id="dynasheet" rel="stylesheet/less" type="text/css" href="assets/app.less" />
        <style type="text/css">
            /**
            * Hide when Angular is not yet loaded and initialized
            */
            [ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak], .ng-cloak, .x-ng-cloak {
            display: none !important;
            }
        </style>
    </head>

    <body ng-app="starterApp" layout="column" ng-controller="JobController as JC" ng-cloak onresize="setMaxJobsHeight()" md-theme="{{default}}" md-theme-watch="true">
    <div ng-show="SHOW_INTERFACE">
            <md-toolbar layout="row">
                <img ng-show="showAllJobs && !ShowGeneralSettings.show" id="app_icon" style="max-height:40px; margin: 10px 0 0 10px" src="/res/dynamic.png" onerror="this.style.visibility = 'hidden'; document.getElementById('app_title').style.visibility = 'visible'">
                <a ng-hide="showAllJobs && !ShowGeneralSettings.show" href="/app/index.html" ng-click="ShowGeneralSettings.show = false; showAllJobs = true;"><md-icon style="width:50px; padding-left:16px; padding-top:18px; cursor:pointer">arrow_back</md-icon></a>
                <h1 ng-show="showAllJobs && !ShowGeneralSettings.show" ng-click="ShowGeneralSettings.show = false; showAllJobs = true;" style="cursor:pointer;">
                    <span id="app_title" style="/*visibility:hidden;*/ margin-top:calc(100%); margin-left:20px">{{application_title}}</span>
                </h1>
                <h1 ng-show="ShowGeneralSettings.show">{{_('General configurations page')}}</h1>
                <span flex></span>
                <div style="margin-right:28px;" ng-show="showAllJobs && !ShowGeneralSettings.show">
                    <div style="padding-top: calc(100%)"><a ng-click="ShowGeneralSettings.show = !ShowGeneralSettings.show" href="#/settings"><md-icon style="cursor:pointer">settings</md-icon></a>
                        <md-tooltip md-direction="bottom">
                            {{_('General configurations page')}}
                        </md-tooltip></div>
                </div>
            </md-toolbar>
            <span ng-hide="showAllJobs || ShowGeneralSettings.show" style="height: 100%;">
                <ng-include src="'./src/jobs/view/fulljob_toolbar.html'"/>
            </span>
        </div>
        <div ng-view>
            <!-- routed ng-views -->
        </div>
        <div flex layout="column">
            <!-- md-is-locked-open="$mdMedia('gt-md')" -->
            <md-sidenav  ng-click="JC.toggleList()" md-component-id="left" class="md-whiteframe-z2" >
                <md-list>
                    <md-list-item>
                        <md-button ng-init="showAllJobs = false" ng-click="showAllJobs=!showAllJobs; ShowGeneralSettings.show = false" aria-label="Home"><i class="material-icons">home</i></md-button>
                    </md-list-item>
                    <md-list-item ng-repeat="it in JC.jobs" layout="row">
                        <md-button ng-click="JC.selectJob(it)" ng-class="{'selected' : it === JC.selected }" style="display: table;">
                            <div style="display: table-cell">
                                <!--<i style="vertical-align: middle; font-size:17px;" class="material-icons" ng-if="it.state.global.queue_done == 0">check_circle</i>-->
                                <i style="vertical-align: middle; font-size:17px;" class="material-icons" ng-if="it.running && it.state.global.queue_done <= 0">sync</i>
                                <md-progress-circular ng-if="it.state.global.queue_done > 0" md-mode="determinate" value="{{it.state.global.queue_done}}" md-diameter="30" style="display: table-cell;"></md-progress-circular>
                            </div>
                            <div style="display: table-cell;  padding-left: 10px;">{{it.label}}</div>
                        </md-button>
                    </md-list-item>
                </md-list>
                <md-button class="md-fab md-mini" aria-label="Add Sync Task" style="margin-left: 80%;"  ng-click="JC.newSyncTask($event);">
                    <md-icon aria-hidden="true">add</md-icon>
                </md-button>
            </md-sidenav>
            <span ng-hide="showAllJobs || ShowGeneralSettings.show" style="height: 100%;">
                <ng-include src="'./src/jobs/view/fulljob.html'"/>
            </span>
            <span ng-show="showAllJobs && !ShowGeneralSettings.show">
                <ng-include src="'./src/jobs/view/alljobs.html'"/>
            </span>
            <!--<span ng-show="showGeneralSettings" style="height: 100%;">
                <ng-include src="'./src/jobs/view/general_configs.html'"/>
            </span>-->
        </div>
    <script type="text/javascript" src="bundle.min.js"></script>

    <script type="text/javascript" src="./src/jobs/JobController.js"></script>
    <script type="text/javascript" src="./src/jobs/NewJobController.js"></script>
    <script type="text/javascript" src="./src/jobs/SettingsController.js"></script>
    <script type="text/javascript" src="./src/jobs/JobService.js"></script>
    <script type="text/javascript" src="./src/jobs/HistoryController.js"></script>
    <script type="text/javascript" src="./src/jobs/ShareController.js"></script>

    <script type="text/javascript" src="./assets/moment-with-locales.js"></script>
    <script type="text/javascript">
              // globals for basic themeing
              var pydiotheme = { 'base': 'blue', 'hue': '500', 'accent': 'orange', 'background': '#0288D1'}
              var primarycolor;
              // see configs.js
    </script>
    <script src="i18n.js"></script>
    <script type="text/javascript">_ = window.translate</script>
    <script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <script src="config.js"></script>
        <!-- set options before less.js script -->
    <script>
      less = {
        env: "development",
        async: false,
        fileAsync: false,
        poll: 1000,
        functions: {},
        logLevel: 2,
        dumpLineNumbers: "comments",
        relativeUrls: false,
        rootpath: ":/a.com/"
      };
    </script>
    <script src="assets/less.js" type="text/javascript"></script>
    <script src="assets/w3color.js" type="text/javascript"></script>
    <script type="text/javascript">
          // take care of configs.js
          logTheme()
          // list of Angular themes
          var colors = ["red", "pink", "purple", "deep-purple", "indigo", "blue", "light-blue", "cyan", "teal", "green", "light-green", "lime", "yellow", "amber", "orange", "deep-orange", "brown", "grey", "blue-grey"];
          angular
              .module('starterApp', ['ngMaterial', 'jobs'])
              .config(function($mdThemingProvider){
                    if ( (colors.indexOf(pydiotheme.base) > -1 ) && (colors.indexOf(pydiotheme.accent) > -1 )&& (pydiotheme.base !== pydiotheme.accent) ){
                        $mdThemingProvider.theme('default')
                          .primaryPalette(pydiotheme.base, {'default': pydiotheme.hue})
                          .accentPalette(pydiotheme.accent);
                    } else {
                        if ( colors.indexOf(pydiotheme.base) > -1 ){
                            // Base in colors
                            // accent not in color, register accent
                            registerPalette($mdThemingProvider, 'accentPalette', pydiotheme.accent, pydiotheme.background)
                            $mdThemingProvider.theme('default').primaryPalette(pydiotheme.base).accentPalette('accentPalette');
                        } else if ( colors.indexOf(pydiotheme.accent) > -1 ){
                            // Accent in colors
                            // base not in color, register base
                            registerPalette($mdThemingProvider, 'basePalette', pydiotheme.base, pydiotheme.background)
                            $mdThemingProvider.theme('default').primaryPalette('basePalette').accentPalette(pydiotheme.accent);
                        } else {
                            // else register both
                            try {
                                registerPalette($mdThemingProvider, 'accentPalette', pydiotheme.accent, pydiotheme.background)
                                registerPalette($mdThemingProvider, 'basePalette', pydiotheme.base, pydiotheme.background)
                                $mdThemingProvider.theme('default').primaryPalette('basePalette').accentPalette('accentPalette');
                            } catch (e) {
                                console.log(e)
                                $mdThemingProvider.theme('default').primaryPalette('blue').accentPalette('orange').contrastDefaultColor(blackOrWhite(pydiotheme.background)==='white'?'light':'dark');
                            }
                        }
                    }
              });
          function logTheme(){
              console.log("THEME SET to ")
              for (var i in pydiotheme){
                console.log(" " + i + " " + pydiotheme[i])
              }
          }

          function setMaxJobsHeight(){
            // resize some components to various window sizes
            document.getElementById('joblist').style.maxHeight = (window.innerHeight - 70) + "px"
            document.getElementById('full-job-scroller').style.maxHeight = (window.innerHeight - 165) + "px"
            document.getElementById('settingsForm').style.maxHeight = (window.innerHeight - 165) + "px"
            document.getElementById('aboutDiv').style.maxHeight = (window.innerHeight - 165) + "px"
          }

          function registerPalette(provider, name, color, background){
            provider.definePalette(name, {
                '50': color,
                '100': color,
                '200': color,
                '300': color,
                '400': color,
                '500': color,
                '600': color,
                '700': color,
                '800': color,
                '900': color,
                'A100': color,
                'A200': color,
                'A400': color,
                'A700': color,
                'contrastDefaultColor': blackOrWhite(background)==='white'?'light':'dark',    // default text is light
                'contrastDarkColors': ['50', '100', '200', '300', '400', 'A100'], // will have dark
                'contrastLightColors': undefined    // alternative 'dark'
            });
          }

          function blackOrWhite(color){
            try {
                var c = w3color(color);
                if (c.valid){
                    var rgb = c.toRgbString().match(/\d+/g);
                    if ( (rgb[0]*0.299 + rgb[1]*0.587 + rgb[2]*0.114) > 186) {
                        return "black"
                    } else {
                        return "white"
                    }
                } else {
                    // default to white
                    return "white";
                }
            } catch (e) {
                console.log("Color issue")
                console.log(e)
                return "white"
            }
          }

          function updateTheme(){
            less.modifyVars({
              '@primary_color': pydiotheme.background,
              '@inverted-font-color': blackOrWhite(pydiotheme.background),
            });
          }

    </script>

    </body>
</html>
