<div ng-controller="HistoryController as hc">
    <md-content ng-show="conflicts.length">
        <md-subheader class="section-title">{{_('Conflicts')}}</md-subheader>
        <div layout="row">
            <span flex></span>
            <md-checkbox ng-model="conflict_solver.applyToAll" ng-init="conflict_solver.applyToAll = false">{{_('Apply to all conflicts')}}</md-checkbox>
            <div style="width:17px;"></div>
        </div>
        <table style="width: 100%; padding-left:17px">
            <tr ng-show="conflict_solver.applyToAll">
                <td></td>
                <td></td>
            <td style="text-align:center">
                {{_('APPLY TO ALL')}}
            </td>
            </tr>
            <tr ng-show="conflict_solver.applyToAll">
                <td></td>
                <td></td>
                <td style="text-align:center">
                    <md-button class="md-raised" ng-click="solveConflict(conflict_solver.current.node_id, 'SOLVED:KEEPLOCAL');">{{_('Mine')}}</md-button>
                    <md-button class="md-raised" ng-click="solveConflict(conflict_solver.current.node_id, 'SOLVED:KEEPBOTH');">{{_('Both Versions')}}</md-button>
                    <md-button class="md-raised" ng-click="solveConflict(conflict_solver.current.node_id, 'SOLVED:KEEPREMOTE');">{{_('Theirs')}}</md-button>
                </td>
            </tr>
            <tr ng-repeat="conflict in conflicts">
                <td style="padding:2px 0;">{{conflict.node_path | basename}}</td>
                <td style="color: rgb(80,80,80); cursor:pointer" ng-click="openFile({'target':selected.directory+conflict.node_path}, $event)">{{selected.directory}}{{conflict.node_path}}</td>
                <td style="text-align:center">
                    <div ng-show="!conflict_solver.applyToAll">
                        <md-button class="md-raised" ng-click="solveConflict(conflict_solver.current.node_id, 'SOLVED:KEEPLOCAL');">{{_('Mine')}}</md-button>
                        <md-button class="md-raised" ng-click="solveConflict(conflict_solver.current.node_id, 'SOLVED:KEEPBOTH');">{{_('Both Versions')}}</md-button>
                        <md-button class="md-raised" ng-click="solveConflict(conflict_solver.current.node_id, 'SOLVED:KEEPREMOTE');">{{_('Theirs')}}</md-button>
                    </div>
                </td>

                <!--<td style="text-align: right;padding:2px 0;">
                    <md-button ng-show="conflict.status.indexOf('SOLVED:') === -1" ng-click="conflict_solver.current=conflict">{{_('Solve Conflict')}}</md-button>
                    <span ng-show="conflict.status.indexOf('SOLVED:') === 0" class="small">{{_('Solved')}}</span>
                </td>-->
            </tr>
        </table>
    </md-content>
    <md-content>
        <div ng-show="running.tasks && running.tasks.total" class="full-job-status-running">
            {{_('Status')}}: {{_('syncing')}} - {{_('Size')}}: {{running.global.queue_bytesize | bytes}} - {{_('Estimated time')}}: {{running.global.eta | seconds}}
        </div>
    </md-content>
    <md-content flex ng-show="running.tasks && running.tasks.total != 0">
        <md-list class="md-dense" flex>
            <md-subheader class="md-no-sticky" >
                {{_('Currently processing ')}}{{running.tasks.current.length}} {{_(' tasks (')}}
            </md-subheader>
            <div class="change-history-line" ng-repeat="item in running.tasks.current">
                <span class="progress-cell" ng-if="item.node.bytesize">
                    <md-progress-circular md-mode="determinate" md-diameter="20px" value="{{100*(item.total_bytes_sent/item.total_size)}}"></md-progress-circular>
                </span>
                <i class="material-icons change-history-icon" ng-if="item.type == 'delete'">delete</i>
                <span class="change-history-text">
                    <span ng-if="item.node.node_path">
                        {{ item.node.node_path }}
                        <span ng-if="item.node.bytesize"> - {{ item.node.bytesize | bytes:1}}</span>
                    </span>
                    <span ng-if="!item.node.node_path">{{item.source}}</span>
                </span>
            </div>
            <div ng-show="running.tasks.total > 5" class="change-history-line">
                <span class="empty-cell"></span>
                <span class="change-history-text" style="opacity: 0.5; font-style: italic;">
                    {{running.tasks.total - 5}} more ...
                </span>
            </div>
        </md-list>

    </md-content>
<!--
    {{running.tasks}}
-->
    <md-content flex>
        <md-list class="md-dense">
            <md-subheader class="md-no-sticky">{{_('Last synchronized files')}}</md-subheader>
            <div style="width:100px; height:100px; margin: 20px 0 0 50%" ng-show="!logs.length">
                <md-progress-circular md-mode="indeterminate" md-diameter="40px" ></md-progress-circular>
            </div>
            <div class="change-history-line" ng-repeat="item in logs" ng-if="item.type != 'sync'">
                <span>
                    <i class="material-icons change-history-icon" ng-if="item.action == 'delete'">delete</i>
                    <i class="material-icons change-history-icon" ng-if="item.action !== 'delete' && item.type == 'remote'">cloud_upload</i> <!--file_upload-->
                    <i class="material-icons change-history-icon" ng-if="item.action !== 'delete' && item.type == 'local'">cloud_download</i> <!--file_download-->
                </span>
                <span class="change-history-text" ng-click="showChangeDetails(item, $event)">
                    {{ item.message }}
                </span>
                <md-icon class="md-secondary" ng-click="openFile(item, $event)">open_in_new</md-icon>
            </div>
        </md-list>
    </md-content>

</div>
